{% extends 'base.html.twig' %}

{% block title %}Dashboard - Gembira{% endblock %}

{% block body %}
<!-- Header -->
<div class="bg-gradient-to-r from-sky-400 to-sky-500 text-white sticky top-0 z-40 shadow-lg">
    <div class="container mx-auto px-4 py-4">
        <div class="flex items-center justify-between">
            <div class="flex-1">
                <h1 class="text-lg font-bold">ü§≤ GEMBIRA</h1>
                <p class="text-sky-100 text-xs">Gerakan Munajat Bersama Untuk Kinerja</p>
            </div>
            
            <!-- Informasi Pengguna & Logout - Enhanced -->
            <div class="relative z-50">
                <button id="userMenuButton" onclick="toggleDropdown()" class="flex items-center space-x-2 bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-2 rounded-lg text-sm backdrop-blur-sm transition-all">
                    <div class="text-right">
                        <div class="font-medium">{{ app.user.nama }}</div>
                        <div class="text-xs text-sky-100">{{ app.user.nip }}</div>
                    </div>
                    <div class="text-lg">üë§</div>
                    <!-- Dropdown Arrow -->
                    <svg id="dropdownArrow" class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>

                <!-- Menu Dropdown - Enhanced -->
                <div id="userDropdown" class="hidden absolute right-0 top-full mt-2 bg-white border border-gray-200 rounded-lg shadow-xl min-w-[220px] z-[60] transform opacity-0 scale-95 transition-all duration-200">
                    <div class="p-3 border-b border-gray-200 bg-gray-50 rounded-t-lg">
                        <div class="text-sm font-medium text-gray-900">{{ app.user.nama }}</div>
                        <div class="text-xs text-gray-500">{{ app.user.jabatan }}</div>
                        {% if app.user.unitKerja %}
                        <div class="text-xs text-gray-400">{{ app.user.unitKerja }}</div>
                        {% endif %}
                    </div>
                    <div class="py-1">
                        <a href="{{ path('app_profile_view') }}" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                            <span class="mr-3">üë§</span>
                            <span>Profil</span>
                        </a>
                        <a href="{{ path('app_absensi_dashboard') }}" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-green-50 hover:text-green-600 transition-colors">
                            <span class="mr-3">ü§≤</span>
                            <span>Dashboard Absensi</span>
                        </a>
                        <a href="{{ path('app_profile_change_password') }}" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-purple-50 hover:text-purple-600 transition-colors">
                            <span class="mr-3">üîê</span>
                            <span>Ganti Password</span>
                        </a>
                        <a href="{{ path('app_profile_tanda_tangan') }}" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-yellow-50 hover:text-yellow-600 transition-colors">
                            <span class="mr-3">üìù</span>
                            <span>Tanda Tangan</span>
                        </a>
                        <hr class="my-1">
                        {% include 'components/logout_button.html.twig' with {
                            'style': 'w-full flex items-center px-4 py-3 text-sm text-red-600 hover:bg-red-50 hover:text-red-700 border-0 bg-transparent transition-colors',
                            'text': 'Logout',
                            'icon': 'üö™'
                        } %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Informasi Selamat Datang -->
        <div class="mt-3 bg-white bg-opacity-20 rounded-lg p-3 backdrop-blur-sm">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium">Selamat datang!</p>
                    <p class="text-xs text-sky-100">{{ 'now'|date('d F Y') }}</p>
                </div>
                <div class="text-right">
                    <div class="text-lg font-bold" id="jam-sekarang-header">--:--</div>
                    <div class="text-xs text-sky-100">WITA</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Dynamic Banner Carousel -->
{% if sliders is defined and sliders|length > 0 %}
    <!-- Data slider tersedia: {{ sliders|length }} slider(s) -->
    {{ include('components/slider_carousel.html.twig') }}
{% else %}
    <!-- Fallback: Gunakan banner original -->
    <div class="bg-gradient-to-r from-sky-300 to-sky-400 py-4 shadow-sm">
        <div class="container mx-auto px-4">
            <div class="relative overflow-hidden rounded-lg">
                <div class="flex transition-transform duration-500 ease-in-out" id="banner-slider">
                    <!-- Slide 1 -->
                    <div class="min-w-full bg-white bg-opacity-90 backdrop-blur-sm rounded-lg p-4 text-center">
                        <div class="flex items-center justify-center space-x-3">
                            <div class="text-2xl">üì¢</div>
                            <div>
                                <p class="font-semibold text-sky-800">Informasi Penting</p>
                                <p class="text-sm text-sky-600">Jangan lupa absensi sesuai jadwal yang ditentukan</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Slide 2 -->
                    <div class="min-w-full bg-white bg-opacity-90 backdrop-blur-sm rounded-lg p-4 text-center">
                        <div class="flex items-center justify-center space-x-3">
                            <div class="text-2xl">üéØ</div>
                            <div>
                                <p class="font-semibold text-sky-800">Tips Absensi</p>
                                <p class="text-sm text-sky-600">Pastikan lokasi GPS aktif untuk absensi yang akurat</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Slide 3 -->
                    <div class="min-w-full bg-white bg-opacity-90 backdrop-blur-sm rounded-lg p-4 text-center">
                        <div class="flex items-center justify-center space-x-3">
                            <div class="text-2xl">‚è∞</div>
                            <div>
                                <p class="font-semibold text-sky-800">Reminder</p>
                                <p class="text-sm text-sky-600">Pastikan absen sesuai jadwal untuk hasil optimal</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Indikator Slide -->
                <div class="flex justify-center mt-3 space-x-2">
                    <button class="w-2 h-2 rounded-full bg-white bg-opacity-60 transition-all" onclick="goToSlide(0)" id="indicator-0"></button>
                    <button class="w-2 h-2 rounded-full bg-white bg-opacity-60 transition-all" onclick="goToSlide(1)" id="indicator-1"></button>
                    <button class="w-2 h-2 rounded-full bg-white bg-opacity-60 transition-all" onclick="goToSlide(2)" id="indicator-2"></button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    // Banner Slide Auto-scroll untuk fallback
    let currentSlide = 0;
    const totalSlides = 3;

    function goToSlide(index) {
        currentSlide = index;
        const slider = document.getElementById('banner-slider');
        if (slider) {
            const translateX = -currentSlide * 100;
            slider.style.transform = `translateX(${translateX}%)`;
            
            // Update indikator
            for (let i = 0; i < totalSlides; i++) {
                const indicator = document.getElementById(`indicator-${i}`);
                if (indicator) {
                    if (i === currentSlide) {
                        indicator.classList.remove('bg-white', 'bg-opacity-60');
                        indicator.classList.add('bg-white', 'bg-opacity-100');
                    } else {
                        indicator.classList.remove('bg-white', 'bg-opacity-100');
                        indicator.classList.add('bg-white', 'bg-opacity-60');
                    }
                }
            }
        }
    }

    function nextSlide() {
        currentSlide = (currentSlide + 1) % totalSlides;
        goToSlide(currentSlide);
    }

    // Auto-scroll setiap 5 detik
    setInterval(nextSlide, 5000);

    // Initialize slide pertama
    goToSlide(0);
    </script>
{% endif %}

<!-- Konten Utama -->
<div class="bg-gradient-to-b from-sky-50 to-sky-100 min-h-screen pb-20">
<div class="container mx-auto px-4 py-6">
    <!-- Informasi Waktu -->
    <div class="bg-white rounded-xl shadow-sm p-4 mb-6 border border-sky-200">
        <div class="text-center">
            <div class="text-3xl font-bold text-sky-800" id="jam-sekarang">--:--:--</div>
            <div class="text-sm text-sky-600">Waktu Sekarang</div>
        </div>
    </div>

    <!-- Card Ranking Absensi Pegawai -->
    {% if ranking_pribadi is defined and ranking_pribadi.posisi > 0 %}
    <div class="bg-white rounded-xl shadow-sm p-4 mb-6 border border-sky-200">
        <div class="text-center border-b border-gray-100 pb-3 mb-4">
            {# PERBAIKAN FORMAT RANKING GLOBAL - SESUAI PERMINTAAN USER #}
            <div class="text-lg font-bold text-sky-800" data-ranking-pribadi>
                üèÖ Ranking Anda: #{{ ranking_pribadi.posisi }} dari {{ ranking_pribadi.total_pegawai }} ({{ ranking_pribadi.persentase }}%) {{ ranking_pribadi.status }}
            </div>
        </div>

        <!-- Informasi Hari dan Kategori -->
        {% if hari_ini %}
        <div class="flex items-center justify-center mb-4">
            <div class="text-lg mr-2">üìÖ</div>
            <div class="text-center">
                <div class="font-medium text-sky-800">Hari {{ hari_ini }}</div>
                <div class="text-sm text-sky-600">{{ kartu_absensi|length }} kategori absensi tersedia</div>
            </div>
        </div>
        {% endif %}

        <!-- PERBAIKAN RANKING GROUP - SESUAI FORMAT YANG DIMINTA USER -->
        {% if ranking_group is defined and ranking_group.posisi > 0 %}
        <div class="bg-sky-50 rounded-lg p-3 mb-4">
            <div class="text-center">
                <div class="text-sm font-medium text-sky-700">üìä Ranking Group</div>
                <div class="text-lg font-bold text-sky-800" data-ranking-group>
                    Bagian {{ ranking_group.nama_unit }}: #{{ ranking_group.posisi }} dari {{ ranking_group.total_pegawai }} Pegawai
                </div>
            </div>
        </div>
        {% endif %}

        <!-- PERBAIKAN TOP 10 PEGAWAI - FORMAT TABEL SESUAI PERMINTAAN USER -->
        {% if top_10_pegawai is defined and top_10_pegawai|length > 0 %}
        <div class="bg-yellow-50 rounded-lg p-3">
            <div class="text-center mb-3">
                <div class="text-sm font-medium text-yellow-700">üèÜ Top 10 Pegawai (Global)</div>
            </div>

            {# TABEL TOP 10 DENGAN FORMAT: Nama | Unit Kerja | % Kehadiran | Badge #}
            <div class="overflow-x-auto">
                <table class="w-full text-xs">
                    <thead>
                        <tr class="border-b border-yellow-200">
                            <th class="text-left py-1 px-1 text-yellow-800 font-semibold">No</th>
                            <th class="text-left py-1 px-1 text-yellow-800 font-semibold">Nama</th>
                            <th class="text-left py-1 px-1 text-yellow-800 font-semibold">Unit Kerja</th>
                            <th class="text-center py-1 px-1 text-yellow-800 font-semibold">% Kehadiran</th>
                            <th class="text-center py-1 px-1 text-yellow-800 font-semibold">Badge</th>
                        </tr>
                    </thead>
                    <tbody data-top-10>
                        {% for pegawai in top_10_pegawai %}
                        <tr class="{% if loop.index <= 3 %}font-semibold bg-yellow-100{% endif %} {% if loop.index > 1 %}border-t border-yellow-100{% endif %}">
                            <td class="py-1 px-1 text-center">{{ loop.index }}.</td>
                            <td class="py-1 px-1">{{ pegawai.nama }}</td>
                            <td class="py-1 px-1 text-xs">{{ pegawai.unit_kerja|default('Unit Tidak Diketahui') }}</td>
                            <td class="py-1 px-1 text-center font-medium">{{ pegawai.persentase }}%</td>
                            <td class="py-1 px-1 text-center">{{ pegawai.status }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}
    </div>
    {% else %}
    <!-- Jika belum ada data ranking -->
    <div class="bg-white rounded-xl shadow-sm p-4 mb-6 border border-sky-200">
        <div class="text-center">
            <div class="text-2xl mb-2">üìä</div>
            <div class="text-sm font-medium text-gray-600">Data Ranking Belum Tersedia</div>
            <div class="text-xs text-gray-500">Mulai absen rutin untuk melihat ranking Anda</div>
        </div>

        <!-- Informasi Hari tetap ditampilkan -->
        {% if hari_ini %}
        <div class="mt-4 pt-3 border-t border-gray-100">
            <div class="flex items-center justify-center">
                <div class="text-lg mr-2">üìÖ</div>
                <div class="text-center">
                    <div class="font-medium text-sky-800">Hari {{ hari_ini }}</div>
                    <div class="text-sm text-sky-600">{{ kartu_absensi|length }} kategori absensi tersedia</div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Grid Menu Icon Responsif -->
    <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6">
        {% for kartu in kartu_absensi %}
        <!-- Status visual berdasarkan aktif DAN jam terbuka -->
        {% set is_available = kartu.aktif and kartu.jam_terbuka %}
        {% set icon_bg_color = is_available ? 'bg-white' : 'bg-gray-200' %}
        {% set icon_text_color = is_available ? 'text-sky-600' : 'text-gray-400' %}
        {% set label_text_color = is_available ? 'text-sky-800' : 'text-gray-500' %}
        
        <div class="text-center group">
            <!-- Gunakan jam_terbuka untuk menentukan tombol aktif dan route yang benar -->
            {% if kartu.aktif and kartu.jam_terbuka %}
                <a href="{{ path('app_absensi_proses', {'id': kartu.jadwal.id}) }}"
                   class="block transition-all duration-200 transform hover:scale-105 active:scale-95 touch-manipulation">
            {% else %}
                <div class="block">
            {% endif %}
            
                <!-- Container Icon -->
                <div class="{{ icon_bg_color }} rounded-2xl shadow-md p-6 mb-3 border-2 border-sky-200 {% if is_available %}hover:shadow-lg hover:border-sky-300{% endif %}">
                    <div class="text-4xl {{ icon_text_color }} transition-colors">{{ kartu.icon }}</div>
                    
                    <!-- Indikator status yang akurat -->
                    {% if is_available %}
                        <div class="mt-2 w-2 h-2 bg-green-500 rounded-full mx-auto animate-pulse" title="Tersedia sekarang"></div>
                    {% elseif kartu.aktif and not kartu.jam_terbuka %}
                        <div class="mt-2 w-2 h-2 bg-yellow-500 rounded-full mx-auto" title="Diluar jam absensi"></div>
                    {% else %}
                        <div class="mt-2 w-2 h-2 bg-gray-400 rounded-full mx-auto" title="Tidak tersedia"></div>
                    {% endif %}
                </div>
                
                <!-- Label Teks -->
                <div class="px-1">
                    <p class="text-sm font-semibold {{ label_text_color }} leading-tight mb-1">{{ kartu.nama }}</p>
                    <p class="text-xs text-gray-500">{{ kartu.waktu }}</p>
                    
                    <!-- Informasi status yang jelas -->
                    {% if is_available %}
                        {% if kartu.perlu_qr %}
                            <p class="text-xs text-green-600 mt-1">üì± Scan QR</p>
                        {% else %}
                            <p class="text-xs text-green-600 mt-1">üì∑ Mulai Absensi</p>
                        {% endif %}
                    {% elseif kartu.aktif and not kartu.jam_terbuka %}
                        <p class="text-xs text-yellow-600 mt-1">‚è∞ Diluar Jam</p>
                    {% else %}
                        <p class="text-xs text-gray-400 mt-1">‚ùå Tidak Aktif</p>
                    {% endif %}
                </div>
                
            <!-- Penutup tag sesuai kondisi -->
            {% if is_available %}
                </a>
            {% else %}
                </div>
            {% endif %}
        </div>
        {% else %}
        <!-- Tidak Ada Kategori -->
        <div class="col-span-full">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 text-center">
                <div class="text-6xl mb-4">üìã</div>
                <h3 class="text-lg font-semibold text-gray-700 mb-2">Tidak Ada Absensi Hari Ini</h3>
                <p class="text-gray-500 text-sm">Tidak ada jadwal absensi yang tersedia untuk hari {{ hari_ini }}.</p>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Menu Tambahan -->
    <div class="mt-6 grid grid-cols-2 gap-4">
        <a href="{{ path('app_profile_view') }}" class="bg-white rounded-lg shadow-sm p-4 text-center hover:bg-gray-50 transition-colors">
            <div class="text-2xl mb-2">üë§</div>
            <div class="text-sm font-medium">Profil Saya</div>
        </a>
        <a href="{{ path('app_profile_change_password') }}" class="bg-white rounded-lg shadow-sm p-4 text-center hover:bg-gray-50 transition-colors">
            <div class="text-2xl mb-2">üîê</div>
            <div class="text-sm font-medium">Ganti Password</div>
        </a>
    </div>
</div>
</div>

<!-- Navigasi Bawah - TETAP PERTAHANKAN -->
<div class="fixed bottom-0 left-0 right-0 bg-sky-400 shadow-2xl border-t border-sky-500 z-50">
    <div class="grid grid-cols-5 text-center">
        <!-- Home -->
        <a href="{{ path('app_dashboard') }}" class="flex flex-col items-center py-3 px-2 text-white bg-sky-600 rounded-lg mx-1">
            <div class="text-lg mb-1">üè†</div>
            <div class="text-xs font-medium">Home</div>
        </a>
        
        <!-- Laporan -->
        <a href="{{ path('app_user_laporan') }}" class="flex flex-col items-center py-3 px-2 text-gray-200 hover:text-white hover:bg-sky-500 transition-colors rounded-lg mx-1">
            <div class="text-lg mb-1">üìä</div>
            <div class="text-xs">Laporan</div>
        </a>
        
        <!-- Kalender -->
        <a href="{{ path('app_user_kalender') }}" class="flex flex-col items-center py-3 px-2 text-gray-200 hover:text-white hover:bg-sky-500 transition-colors rounded-lg mx-1">
            <div class="text-lg mb-1">üìÖ</div>
            <div class="text-xs">Kalender</div>
        </a>
        
        <!-- Notifikasi -->
        <a href="#" class="flex flex-col items-center py-3 px-2 text-gray-200 hover:text-white hover:bg-sky-500 transition-colors rounded-lg mx-1">
            <div class="text-lg mb-1">üîî</div>
            <div class="text-xs">Notifikasi</div>
        </a>
        
        <!-- Profil -->
        <a href="{{ path('app_profile_view') }}" class="flex flex-col items-center py-3 px-2 text-gray-200 hover:text-white hover:bg-sky-500 transition-colors rounded-lg mx-1">
            <div class="text-lg mb-1">üë§</div>
            <div class="text-xs">Profil</div>
        </a>
    </div>
</div>

<script>
// Update jam real-time dengan timezone WITA
function updateJam() {
    const sekarang = new Date();
    const jam = sekarang.getHours().toString().padStart(2, '0');
    const menit = sekarang.getMinutes().toString().padStart(2, '0');
    const detik = sekarang.getSeconds().toString().padStart(2, '0');
    
    const jamElement = document.getElementById('jam-sekarang');
    const jamHeaderElement = document.getElementById('jam-sekarang-header');
    
    if (jamElement) jamElement.textContent = `${jam}:${menit}:${detik}`;
    if (jamHeaderElement) jamHeaderElement.textContent = `${jam}:${menit}`;
}

// Enhanced dropdown user menu dengan animasi dan better UX
function toggleDropdown() {
    try {
        const dropdown = document.getElementById('userDropdown');
        const arrow = document.getElementById('dropdownArrow');

        if (!dropdown) {
            console.warn('Dropdown element not found');
            return;
        }

        const isHidden = dropdown.classList.contains('hidden');

        if (isHidden) {
            // Show dropdown with animation
            dropdown.classList.remove('hidden');
            // Force reflow
            dropdown.offsetHeight;
            dropdown.classList.remove('opacity-0', 'scale-95');
            dropdown.classList.add('opacity-100', 'scale-100');

            // Rotate arrow
            if (arrow) {
                arrow.classList.add('rotate-180');
            }
        } else {
            // Hide dropdown with animation
            dropdown.classList.remove('opacity-100', 'scale-100');
            dropdown.classList.add('opacity-0', 'scale-95');

            // Rotate arrow back
            if (arrow) {
                arrow.classList.remove('rotate-180');
            }

            // Hide after animation
            setTimeout(() => {
                dropdown.classList.add('hidden');
            }, 200);
        }
    } catch (error) {
        console.error('Error in toggleDropdown:', error);
    }
}

// Helper function to close dropdown
function closeDropdown() {
    try {
        const dropdown = document.getElementById('userDropdown');
        const arrow = document.getElementById('dropdownArrow');

        if (dropdown && !dropdown.classList.contains('hidden')) {
            dropdown.classList.remove('opacity-100', 'scale-100');
            dropdown.classList.add('opacity-0', 'scale-95');

            if (arrow) {
                arrow.classList.remove('rotate-180');
            }

            setTimeout(() => {
                dropdown.classList.add('hidden');
            }, 200);
        }
    } catch (error) {
        console.error('Error in closeDropdown:', error);
    }
}

// Tutup dropdown ketika klik di luar
document.addEventListener('click', function(event) {
    try {
        const dropdown = document.getElementById('userDropdown');
        const button = event.target.closest('#userMenuButton, [onclick*="toggleDropdown"]');

        if (!button && dropdown && !dropdown.contains(event.target)) {
            closeDropdown();
        }
    } catch (error) {
        console.error('Error in dropdown click handler:', error);
    }
});

// Update setiap detik
setInterval(updateJam, 1000);
updateJam(); // Jalankan segera

// Update ranking data secara periodik (setiap 5 menit)
function updateRankingData() {
    try {
        fetch('{{ path('app_api_ranking_update') }}')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateRankingDisplay(data);
                } else {
                    console.warn('Gagal update ranking:', data.message);
                }
            })
            .catch(error => {
                console.warn('Error update ranking:', error);
            });
    } catch (error) {
        console.error('Error in updateRankingData:', error);
    }
}

// Function untuk update tampilan ranking
function updateRankingDisplay(data) {
    try {
        const rankingPribadi = data.ranking_pribadi;
        const rankingGroup = data.ranking_group;
        const top10 = data.top_10_pegawai;

        // Update ranking pribadi jika ada element
        const rankingPribadiElement = document.querySelector('[data-ranking-pribadi]');
        if (rankingPribadiElement && rankingPribadi.posisi > 0) {
            rankingPribadiElement.innerHTML = `üèÖ Ranking Anda: #${rankingPribadi.posisi} dari ${rankingPribadi.total_pegawai} (${rankingPribadi.persentase}%) ${rankingPribadi.status}`;
        }

        // Update ranking group jika ada element - PERBAIKAN FORMAT SESUAI PERMINTAAN USER
        const rankingGroupElement = document.querySelector('[data-ranking-group]');
        if (rankingGroupElement && rankingGroup.posisi > 0) {
            rankingGroupElement.innerHTML = `Bagian ${rankingGroup.nama_unit}: #${rankingGroup.posisi} dari ${rankingGroup.total_pegawai} Pegawai`;
        }

        // Update top 10 jika ada element - PERBAIKAN FORMAT TABEL SESUAI PERMINTAAN USER
        const top10Element = document.querySelector('[data-top-10]');
        if (top10Element && top10.length > 0) {
            let top10Html = '';
            top10.forEach((pegawai, index) => {
                const isTop3 = index < 3;
                const rowClass = isTop3 ? 'font-semibold bg-yellow-100' : '';
                const borderClass = index > 0 ? 'border-t border-yellow-100' : '';

                top10Html += `
                    <tr class="${rowClass} ${borderClass}">
                        <td class="py-1 px-1 text-center">${index + 1}.</td>
                        <td class="py-1 px-1">${pegawai.nama}</td>
                        <td class="py-1 px-1 text-xs">${pegawai.unit_kerja || 'Unit Tidak Diketahui'}</td>
                        <td class="py-1 px-1 text-center font-medium">${pegawai.persentase}%</td>
                        <td class="py-1 px-1 text-center">${pegawai.status}</td>
                    </tr>
                `;
            });
            top10Element.innerHTML = top10Html;
        }
    } catch (error) {
        console.error('Error updating ranking display:', error);
    }
}

// Update ranking setiap 5 menit
setInterval(updateRankingData, 5 * 60 * 1000);

// Banner slider is now handled by the slider_carousel component

// Optimisasi untuk touch
document.addEventListener('DOMContentLoaded', function() {
    // Tambah feedback sentuh untuk semua tombol
    const buttons = document.querySelectorAll('button, a');
    buttons.forEach(button => {
        button.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.98)';
        });
        button.addEventListener('touchend', function() {
            this.style.transform = 'scale(1)';
        });
    });
});
</script>

<style>
/* Enhanced dropdown animations */
.dropdown-enter {
    opacity: 0;
    transform: scale(0.95) translateY(-10px);
}

.dropdown-enter-active {
    opacity: 1;
    transform: scale(1) translateY(0);
    transition: opacity 200ms ease-out, transform 200ms ease-out;
}

.dropdown-exit {
    opacity: 1;
    transform: scale(1) translateY(0);
}

.dropdown-exit-active {
    opacity: 0;
    transform: scale(0.95) translateY(-10px);
    transition: opacity 200ms ease-in, transform 200ms ease-in;
}

/* Ensure arrow rotation works */
#dropdownArrow {
    transition: transform 0.2s ease-in-out;
}

#dropdownArrow.rotate-180 {
    transform: rotate(180deg);
}

/* Enhanced shadow for dropdown */
#userDropdown {
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    backdrop-filter: blur(8px);
}

/* Mobile touch optimization */
@media (max-width: 640px) {
    #userDropdown {
        min-width: 180px;
        right: -10px;
    }
}
/* Optimisasi Mobile Touch */
.touch-manipulation {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
}

/* Aksesbilitas button yang lebih baik */
button:focus-visible, a:focus-visible {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
}

/* Transisi halus untuk mobile */
* {
    -webkit-transition: all 0.2s ease;
    transition: all 0.2s ease;
}

/* Prevent zoom saat focus input (iOS Safari) */
input[type="text"], input[type="password"] {
    font-size: 16px;
}

/* Shadow card yang lebih baik untuk mobile */
@media (max-width: 768px) {
    .shadow-sm {
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    }
}
</style>
{% endblock %}