{% extends 'base.html.twig' %}

{% block title %}Favorit Saya - Inspirasi{% endblock %}

{% block body %}
<!-- Custom Facebook-Style Header for INSPIRASI -->
<div class="bg-white sticky top-0 z-40 shadow-md border-b border-gray-200">
    <div class="container mx-auto px-4 py-3">
        <div class="flex items-center justify-between">
            <!-- Left: Back Button + Title -->
            <div class="flex items-center gap-3">
                <a href="{{ path('app_ikhlas') }}"
                   class="flex items-center justify-center w-10 h-10 bg-gray-100 hover:bg-gray-200 rounded-full transition-all">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </a>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold text-gray-800">üìö Favorit Inspirasi Saya</h1>
                    <p class="text-xs text-gray-500">Koleksi inspirasi yang Anda simpan</p>
                </div>
            </div>

            <!-- Right: Action Icons -->
            <div class="flex items-center gap-3 md:gap-4">
                <!-- Leaderboard Icon -->
                <a href="{{ path('app_ikhlas_leaderboard') }}"
                   class="flex items-center justify-center w-10 h-10 md:w-11 md:h-11 bg-gray-100 hover:bg-gray-200 rounded-full transition-all duration-200 hover:scale-110 active:scale-95"
                   title="Leaderboard">
                    <span class="text-xl md:text-2xl">üèÜ</span>
                </a>

                <!-- Favorites Icon (Active) -->
                <a href="{{ path('app_ikhlas_favorites') }}"
                   class="flex items-center justify-center w-10 h-10 md:w-11 md:h-11 bg-purple-100 border-2 border-purple-400 rounded-full transition-all duration-200"
                   title="Favorit Saya">
                    <span class="text-xl md:text-2xl">üìö</span>
                </a>

                <!-- Notification Icon -->
                <a href="{{ path('app_notifikasi_index') }}"
                   class="relative flex items-center justify-center w-10 h-10 md:w-11 md:h-11 bg-gray-100 hover:bg-gray-200 rounded-full transition-all duration-200 hover:scale-110 active:scale-95"
                   title="Notifikasi">
                    <span class="text-xl md:text-2xl">üîî</span>
                    {% if app.user.unreadNotifications|default(0) > 0 %}
                    <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs flex items-center justify-center rounded-full border-2 border-white font-bold">
                        {{ app.user.unreadNotifications > 9 ? '9+' : app.user.unreadNotifications }}
                    </span>
                    {% endif %}
                </a>

                <!-- User Avatar/Menu -->
                <div class="relative">
                    {# Level-based border colors #}
                    {% set levelBorder = 'border-gray-300' %}
                    {% if app.user.currentLevel == 1 %}
                        {% set levelBorder = 'border-purple-500' %}
                    {% elseif app.user.currentLevel == 2 %}
                        {% set levelBorder = 'border-green-500' %}
                    {% elseif app.user.currentLevel == 3 %}
                        {% set levelBorder = 'border-blue-500' %}
                    {% elseif app.user.currentLevel == 4 %}
                        {% set levelBorder = 'border-yellow-400' %}
                    {% elseif app.user.currentLevel == 5 %}
                        {% set levelBorder = 'border-amber-500' %}
                    {% endif %}

                    <button id="userMenuButton"
                            onclick="toggleUserDropdown()"
                            class="flex items-center justify-center w-10 h-10 md:w-11 md:h-11 bg-gray-100 hover:bg-gray-200 rounded-full transition-all duration-200 hover:scale-110 active:scale-95">
                        {% if app.user.photo %}
                            <img src="/uploads/photos/{{ app.user.photo }}"
                                 alt="{{ app.user.nama }}"
                                 class="w-6 h-6 md:w-7 md:h-7 object-cover rounded-full border-4 {{ levelBorder }}"
                                 title="Level {{ app.user.currentLevel }} - {{ app.user.levelTitle }}">
                        {% else %}
                            <span class="text-xl md:text-2xl">üë§</span>
                        {% endif %}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="min-h-screen bg-gradient-to-b from-purple-50 via-pink-50 to-sky-50 pb-20">
    <div class="container mx-auto px-4 py-6">
        <div class="max-w-2xl mx-auto">

            <!-- Tabs -->
            <div class="bg-white rounded-xl shadow-sm mb-6">
                <div class="flex border-b border-gray-200">
                    <button id="savedTab" onclick="switchTab('saved')"
                            class="flex-1 py-3 px-4 text-center font-medium transition-colors border-b-2 border-purple-600 text-purple-600">
                        üìå Tersimpan ({{ savedQuotes|length }})
                    </button>
                    <button id="likedTab" onclick="switchTab('liked')"
                            class="flex-1 py-3 px-4 text-center font-medium transition-colors border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                        ‚ù§Ô∏è Disukai ({{ likedQuotes|length }})
                    </button>
                </div>
            </div>

            <!-- Saved Quotes Section -->
            <div id="savedSection" class="space-y-4">
                {% if savedQuotes|length > 0 %}
                    {% for interaction in savedQuotes %}
                        {% set quote = interaction.quote %}
                        <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow p-6">
                            <!-- Category Badge -->
                            <div class="flex items-center justify-between mb-4">
                                <span class="inline-block bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-medium">
                                    {{ quote.category ?? 'Inspirasi' }}
                                </span>
                                <button class="unsave-btn text-yellow-500 hover:text-yellow-600 transition-colors text-xl"
                                        data-quote-id="{{ quote.id }}"
                                        title="Hapus dari favorit">
                                    üìå
                                </button>
                            </div>

                            <!-- Quote Content -->
                            <blockquote class="text-gray-800 text-base md:text-lg leading-relaxed italic font-light mb-4">
                                "{{ quote.content }}"
                            </blockquote>

                            <!-- Author -->
                            <div class="text-right mb-4">
                                <p class="text-sm font-medium text-gray-700">- {{ quote.author ?? 'Anonim' }} -</p>
                            </div>

                            <!-- Stats -->
                            <div class="flex items-center justify-between text-sm text-gray-600 border-t border-gray-100 pt-3">
                                <div class="flex items-center gap-4">
                                    <span class="flex items-center gap-1">
                                        <span>üëÅÔ∏è</span>
                                        <span>{{ quote.totalViews }}</span>
                                    </span>
                                    <span class="flex items-center gap-1">
                                        <span>‚ù§Ô∏è</span>
                                        <span>{{ quote.totalLikes }}</span>
                                    </span>
                                    <span class="flex items-center gap-1">
                                        <span>üí¨</span>
                                        <span>{{ quote.totalComments }}</span>
                                    </span>
                                </div>
                                <a href="{{ path('app_ikhlas') }}#quote-{{ quote.id }}"
                                   class="text-purple-600 hover:text-purple-800 font-medium">
                                    Lihat Detail ‚Üí
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <!-- Empty State -->
                    <div class="bg-white rounded-xl shadow-sm p-12 text-center">
                        <div class="text-6xl mb-4">üìö</div>
                        <h3 class="text-xl font-bold text-gray-700 mb-2">Belum Ada Quote Tersimpan</h3>
                        <p class="text-gray-500 mb-6">Simpan quote favorit Anda dengan klik icon üîñ</p>
                        <a href="{{ path('app_ikhlas') }}"
                           class="inline-block bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-3 rounded-lg font-medium transition-all">
                            Jelajahi Quotes
                        </a>
                    </div>
                {% endif %}
            </div>

            <!-- Liked Quotes Section -->
            <div id="likedSection" class="space-y-4 hidden">
                {% if likedQuotes|length > 0 %}
                    {% for interaction in likedQuotes %}
                        {% set quote = interaction.quote %}
                        <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow p-6">
                            <!-- Category Badge -->
                            <div class="flex items-center justify-between mb-4">
                                <span class="inline-block bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-medium">
                                    {{ quote.category ?? 'Inspirasi' }}
                                </span>
                                <button class="unlike-btn text-red-500 hover:text-red-600 transition-colors text-xl"
                                        data-quote-id="{{ quote.id }}"
                                        title="Unlike">
                                    ‚ù§Ô∏è
                                </button>
                            </div>

                            <!-- Quote Content -->
                            <blockquote class="text-gray-800 text-base md:text-lg leading-relaxed italic font-light mb-4">
                                "{{ quote.content }}"
                            </blockquote>

                            <!-- Author -->
                            <div class="text-right mb-4">
                                <p class="text-sm font-medium text-gray-700">- {{ quote.author ?? 'Anonim' }} -</p>
                            </div>

                            <!-- Stats -->
                            <div class="flex items-center justify-between text-sm text-gray-600 border-t border-gray-100 pt-3">
                                <div class="flex items-center gap-4">
                                    <span class="flex items-center gap-1">
                                        <span>üëÅÔ∏è</span>
                                        <span>{{ quote.totalViews }}</span>
                                    </span>
                                    <span class="flex items-center gap-1">
                                        <span>‚ù§Ô∏è</span>
                                        <span>{{ quote.totalLikes }}</span>
                                    </span>
                                    <span class="flex items-center gap-1">
                                        <span>üí¨</span>
                                        <span>{{ quote.totalComments }}</span>
                                    </span>
                                </div>
                                <a href="{{ path('app_ikhlas') }}#quote-{{ quote.id }}"
                                   class="text-purple-600 hover:text-purple-800 font-medium">
                                    Lihat Detail ‚Üí
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <!-- Empty State -->
                    <div class="bg-white rounded-xl shadow-sm p-12 text-center">
                        <div class="text-6xl mb-4">‚ù§Ô∏è</div>
                        <h3 class="text-xl font-bold text-gray-700 mb-2">Belum Ada Quote yang Disukai</h3>
                        <p class="text-gray-500 mb-6">Beri like pada quote yang Anda suka</p>
                        <a href="{{ path('app_ikhlas') }}"
                           class="inline-block bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-3 rounded-lg font-medium transition-all">
                            Jelajahi Quotes
                        </a>
                    </div>
                {% endif %}
            </div>

        </div>
    </div>
</div>

<!-- Bottom Navigation -->
{% include 'components/bottom_nav.html.twig' with {'active_menu': 'ikhlas'} %}

<!-- Toast Container -->
<div id="toastContainer" class="fixed bottom-24 right-4 z-50 space-y-2"></div>

{% endblock %}

{% block javascripts %}
<script>
// Tab Switching
function switchTab(tab) {
    const savedTab = document.getElementById('savedTab');
    const likedTab = document.getElementById('likedTab');
    const savedSection = document.getElementById('savedSection');
    const likedSection = document.getElementById('likedSection');

    if (tab === 'saved') {
        savedTab.classList.add('border-purple-600', 'text-purple-600');
        savedTab.classList.remove('border-transparent', 'text-gray-500');
        likedTab.classList.remove('border-purple-600', 'text-purple-600');
        likedTab.classList.add('border-transparent', 'text-gray-500');

        savedSection.classList.remove('hidden');
        likedSection.classList.add('hidden');
    } else {
        likedTab.classList.add('border-purple-600', 'text-purple-600');
        likedTab.classList.remove('border-transparent', 'text-gray-500');
        savedTab.classList.remove('border-purple-600', 'text-purple-600');
        savedTab.classList.add('border-transparent', 'text-gray-500');

        likedSection.classList.remove('hidden');
        savedSection.classList.add('hidden');
    }
}

// Unsave Quote
document.querySelectorAll('.unsave-btn').forEach(btn => {
    btn.addEventListener('click', async function() {
        const quoteId = parseInt(this.dataset.quoteId);

        if (!confirm('Hapus quote ini dari favorit?')) return;

        try {
            const response = await fetch('/ikhlas/api/interact', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    quoteId: quoteId,
                    action: 'save'
                })
            });

            const data = await response.json();

            if (data.success) {
                showToast('Quote dihapus dari favorit', 'success');
                setTimeout(() => location.reload(), 1000);
            } else {
                showToast('‚ùå ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('‚ùå Terjadi kesalahan', 'error');
        }
    });
});

// Unlike Quote
document.querySelectorAll('.unlike-btn').forEach(btn => {
    btn.addEventListener('click', async function() {
        const quoteId = parseInt(this.dataset.quoteId);

        if (!confirm('Unlike quote ini?')) return;

        try {
            const response = await fetch('/ikhlas/api/interact', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    quoteId: quoteId,
                    action: 'like'
                })
            });

            const data = await response.json();

            if (data.success) {
                showToast('Like dibatalkan', 'success');
                setTimeout(() => location.reload(), 1000);
            } else {
                showToast('‚ùå ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('‚ùå Terjadi kesalahan', 'error');
        }
    });
});

// Toast Notification
function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `transform transition-all duration-300 ease-in-out ${
        type === 'success' ? 'bg-green-500' : 'bg-red-500'
    } text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 max-w-sm`;
    toast.innerHTML = `
        <span>${message}</span>
        <button onclick="this.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">‚úï</button>
    `;

    const container = document.getElementById('toastContainer');
    container.appendChild(toast);

    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}
</script>

<style>
/* Tab animations */
.transition-colors {
    transition: color 0.2s ease, border-color 0.2s ease;
}

/* Card hover effects */
.hover\:shadow-lg:hover {
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}
</style>
{% endblock %}
